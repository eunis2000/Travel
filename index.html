  <!DOCTYPE html>
  <html lang="zh-HK">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <title>Minty Travel âœˆï¸</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
      <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
      <style>
          body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #f0fdf4; }
          .hide-scrollbar::-webkit-scrollbar { display: none; }
          .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
          .mint-gradient { background: linear-gradient(135deg, #34d399 0%, #10b981 100%); }
          .card-shadow { box-shadow: 0 4px 15px rgba(16, 185, 129, 0.1); }
          .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
          .fade-enter-from, .fade-leave-to { opacity: 0; }
          .list-move, .list-enter-active, .list-leave-active { transition: all 0.5s ease; }
          .list-enter-from, .list-leave-to { opacity: 0; transform: translateX(30px); }
          .list-leave-active { position: absolute; }
      </style>
  </head>
  <body class="text-slate-600 pb-24">

      <div id="app" class="max-w-md mx-auto min-h-screen bg-[#f0fdf4] relative shadow-2xl overflow-hidden">
          
          <!-- é ‚éƒ¨æ¨™é¡Œ -->
          <header class="bg-white/80 backdrop-blur-md sticky top-0 z-20 px-6 py-4 border-b border-teal-100 flex justify-between items-center">
              <h1 class="text-xl font-bold text-teal-600 flex items-center gap-2">
                  <span>âœˆï¸</span> å¤§é˜ªä¹‹æ—…
              </h1>
              <div class="text-xs font-bold text-teal-400 bg-teal-50 px-2 py-1 rounded-lg">
                  12/05 - 12/09
              </div>
          </header>

          <!-- 1. è¡Œç¨‹é é¢ -->
          <div v-if="currentTab === 'itinerary'" class="p-4 space-y-4 pb-24">
              <div class="flex overflow-x-auto gap-2 pb-2 hide-scrollbar">
                  <button v-for="(day, index) in itinerary" :key="index"
                      @click="currentDayIndex = index"
                      :class="currentDayIndex === index ? 'bg-teal-500 text-white shadow-lg shadow-teal-200' : 'bg-white text-teal-500 border border-teal-100'"
                      class="flex-shrink-0 px-4 py-2 rounded-xl font-bold text-sm transition-all whitespace-nowrap">
                      {{ day.date }}
                  </button>
              </div>

              <div class="space-y-3 relative">
                  <transition-group name="list">
                      <div v-for="(event, idx) in itinerary[currentDayIndex].events" :key="event.id || idx" class="bg-white p-4 rounded-2xl card-shadow border-l-4 border-teal-400 relative group mb-3">
                          <button @click="toggleEdit(currentDayIndex, idx)" class="absolute top-2 right-2 text-gray-300 hover:text-teal-500">âœ</button>
                          <div v-if="!event.isEditing">
                              <div class="flex items-center gap-3 mb-2">
                                  <span class="bg-teal-50 text-teal-600 text-xs font-bold px-2 py-1 rounded">{{ event.time }}</span>
                                  <h3 class="font-bold text-gray-700">{{ event.activity }}</h3>
                              </div>
                              <div class="flex items-center justify-between text-sm text-gray-500 pl-1">
                                  <div class="flex items-center gap-1 truncate max-w-[70%]"><span>ğŸ“</span> {{ event.location }}</div>
                                  <a :href="getMapLink(event.location)" target="_blank" class="text-teal-500 font-bold text-xs flex items-center gap-1 bg-teal-50 px-2 py-1 rounded-full hover:bg-teal-100">å°èˆª â†—</a>
                              </div>
                              <div v-if="event.transport" class="mt-2 text-xs text-slate-400 flex items-center gap-1 border-t border-gray-50 pt-2"><span>ğŸš‡</span> {{ event.transport }}</div>
                          </div>
                          <div v-else class="space-y-2">
                              <div class="flex gap-2">
                                  <input v-model="event.time" type="time" class="w-1/3 bg-gray-50 p-2 rounded text-sm">
                                  <input v-model="event.activity" type="text" placeholder="æ´»å‹•åç¨±" class="w-2/3 bg-gray-50 p-2 rounded text-sm font-bold">
                              </div>
                              <input v-model="event.location" type="text" placeholder="è¼¸å…¥åœ°å€" class="w-full bg-gray-50 p-2 rounded text-sm">
                              <input v-model="event.transport" type="text" placeholder="äº¤é€šæ–¹å¼" class="w-full bg-gray-50 p-2 rounded text-sm">
                              <div class="flex gap-2">
                                  <button @click="deleteEvent(currentDayIndex, idx)" class="w-1/4 bg-red-100 text-red-400 text-xs font-bold py-2 rounded-lg">åˆªé™¤</button>
                                  <button @click="toggleEdit(currentDayIndex, idx)" class="w-3/4 bg-teal-500 text-white text-xs font-bold py-2 rounded-lg">å®Œæˆ</button>
                              </div>
                          </div>
                      </div>
                  </transition-group>
                  <button @click="addEvent(currentDayIndex)" class="w-full py-3 border-2 border-dashed border-teal-200 text-teal-400 rounded-xl font-bold text-sm hover:bg-teal-50 transition">+ æ–°å¢è¡Œç¨‹</button>
              </div>
              
              <div class="mt-4 text-center">
                  <button @click="copyItineraryText" class="text-teal-500 text-xs font-bold underline">ğŸ“‹ è¤‡è£½è¡Œç¨‹æ–‡å­—åˆ†äº«</button>
              </div>
          </div>

          <!-- 2. è³¼ç‰©è¨˜å¸³é é¢ (æ›´æ–°ï¼šæ¥µç°¡åˆ†é¡) -->
          <div v-if="currentTab === 'shopping'" class="p-4 space-y-4">
              <div class="mint-gradient rounded-2xl p-5 text-white shadow-lg shadow-teal-200">
                  <div class="flex justify-between items-end">
                      <div>
                          <div class="text-teal-100 text-xs">ç¸½æ¶ˆè²» (JPY)</div>
                          <div class="text-2xl font-bold">Â¥{{ formatNumber(totalYen) }}</div>
                      </div>
                      <div class="text-right">
                          <div class="text-teal-100 text-xs">ç´„åˆæ¸¯å¹£ ({{ rate }})</div>
                          <div class="text-xl font-bold">HK${{ formatNumber(totalHKD) }}</div>
                      </div>
                  </div>
              </div>

              <!-- æ–°å¢ç‰©å“å€ -->
              <div class="bg-white p-4 rounded-2xl card-shadow space-y-3">
                  <!-- æ¥µç°¡åˆ†é¡é¸æ“‡å™¨ -->
                  <div class="flex gap-2 overflow-x-auto pb-1 hide-scrollbar">
                      <button v-for="cat in categories" :key="cat.id" 
                          @click="newItem.category = cat.id"
                          :class="newItem.category === cat.id ? cat.activeClass : 'bg-gray-50 text-gray-400 hover:bg-gray-100'"
                          class="px-4 py-2 rounded-lg text-xs font-bold transition whitespace-nowrap">
                          {{ cat.name }}
                      </button>
                  </div>

                  <div class="flex gap-2">
                      <input v-model="newItem.name" type="text" placeholder="ç‰©å“åç¨±" class="flex-1 bg-gray-50 p-2 rounded-xl text-sm outline-none focus:ring-2 focus:ring-teal-200">
                      <input v-model="newItem.forWhom" type="text" placeholder="çµ¦èª°?" class="w-20 bg-gray-50 p-2 rounded-xl text-sm outline-none focus:ring-2 focus:ring-teal-200">
                  </div>
                  <div class="flex gap-2 items-center">
                      <input v-model.number="newItem.price" type="number" placeholder="åƒ¹æ ¼ (å††)" class="flex-1 bg-gray-50 p-2 rounded-xl text-sm outline-none focus:ring-2 focus:ring-teal-200">
                      <div class="relative">
                          <button @click="$refs.shopCam.click()" class="p-2 rounded-xl transition" :class="tempShopImg ? 'bg-teal-100 text-teal-600' : 'bg-gray-100 text-gray-400'">ğŸ“·</button>
                          <input type="file" ref="shopCam" accept="image/*" capture="environment" class="hidden" @change="handleShopImgUpload">
                          <div v-if="tempShopImg" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></div>
                      </div>
                      <button @click="addItem" class="bg-teal-500 text-white px-4 py-2 rounded-xl font-bold shadow-md shadow-teal-100 active:scale-95 transition text-sm">è¨˜å¸³</button>
                  </div>
                  <div v-if="tempShopImg" class="relative inline-block mt-2">
                      <img :src="tempShopImg" class="h-16 w-16 object-cover rounded-lg border border-teal-200">
                      <button @click="tempShopImg = null" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">Ã—</button>
                  </div>
              </div>

              <!-- åˆ—è¡¨é¡¯ç¤º (æ›´æ–°ï¼šç„¡åœ–æ™‚é¡¯ç¤ºæ–‡å­—é ­åƒ) -->
              <div class="space-y-2 pb-20">
                  <div v-for="(item, index) in shoppingList" :key="index" class="bg-white p-3 rounded-xl border border-gray-100 flex gap-3 items-center relative overflow-hidden">
                      <!-- å·¦å´ç¸®åœ–æˆ–æ–‡å­—é ­åƒ -->
                      <div @click="item.image ? openImageModal(item.image) : null" class="w-12 h-12 rounded-lg flex-shrink-0 overflow-hidden flex items-center justify-center cursor-pointer ml-1" :class="!item.image ? getCategoryBg(item.category) : 'bg-gray-50 border border-gray-100'">
                          <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                          <!-- ç„¡åœ–æ™‚é¡¯ç¤ºåˆ†é¡é¦–å­— -->
                          <span v-else class="text-lg font-bold opacity-80" :class="getCategoryText(item.category)">
                              {{ getCategoryName(item.category).charAt(0) }}
                          </span>
                      </div>

                      <div class="flex-1 min-w-0">
                          <div class="font-bold text-gray-700 truncate">{{ item.name }}</div>
                          <div class="flex gap-2 mt-1">
                              <span class="text-[10px] px-1.5 py-0.5 rounded bg-gray-50 text-gray-400">{{ getCategoryName(item.category) }}</span>
                              <span v-if="item.forWhom" class="text-[10px] px-1.5 py-0.5 rounded bg-orange-50 text-orange-400">çµ¦: {{ item.forWhom }}</span>
                          </div>
                      </div>
                      <div class="text-right">
                          <div class="font-bold text-teal-600">Â¥{{ item.price }}</div>
                          <button @click="deleteItem(index)" class="text-xs text-red-300 mt-1 px-2">åˆªé™¤</button>
                      </div>
                  </div>
                  <div v-if="shoppingList.length === 0" class="text-center text-gray-300 py-10 text-sm">é‚„æ²’è²·æ±è¥¿å‘¢ ğŸ›ï¸</div>
              </div>
          </div>

          <!-- 3. ç…§ç‰‡è¨˜éŒ„é é¢ -->
          <div v-if="currentTab === 'photos'" class="p-4 pb-24">
              <div @click="$refs.photoInput.click()" class="w-full h-24 border-2 border-dashed border-teal-300 rounded-xl flex flex-col items-center justify-center bg-teal-50 cursor-pointer hover:bg-teal-100 transition mb-6">
                  <span class="text-2xl">ğŸ“·</span>
                  <span class="text-xs text-teal-500 font-bold mt-1">æ–°å¢ä»Šæ—¥ç…§ç‰‡</span>
                  <input type="file" ref="photoInput" accept="image/*" class="hidden" @change="handlePhotoUpload">
              </div>
              <div v-for="(group, date) in groupedPhotos" :key="date" class="mb-6">
                  <h3 class="font-bold text-teal-600 mb-2 pl-1 flex items-center gap-2">
                      ğŸ“… {{ date }} <span class="text-xs font-normal text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">{{ group.length }} å¼µ</span>
                  </h3>
                  <div class="grid grid-cols-3 gap-2">
                      <div v-for="(photo, idx) in group" :key="idx" class="aspect-square rounded-lg overflow-hidden relative group bg-gray-100">
                          <img :src="photo.src" @click="openImageModal(photo.src)" class="w-full h-full object-cover cursor-pointer">
                          <button @click="deletePhoto(photo.originalIndex)" class="absolute top-1 right-1 bg-black/50 text-white rounded-full w-5 h-5 text-[10px] flex items-center justify-center opacity-0 group-hover:opacity-100 transition">âœ•</button>
                      </div>
                  </div>
              </div>
              <div v-if="photos.length === 0" class="text-center text-gray-300 py-10">æš«ç„¡ç…§ç‰‡</div>
          </div>

          <!-- 4. å·¥å…·é é¢ -->
          <div v-if="currentTab === 'tools'" class="p-4 space-y-4">
              <div class="bg-white p-5 rounded-2xl border border-teal-200 shadow-sm">
                  <h3 class="font-bold text-teal-600 mb-3 flex items-center gap-2">ğŸ’¾ æ•¸æ“šå‚™ä»½ä¸­å¿ƒ</h3>
                  <p class="text-xs text-gray-400 mb-4">å°‡è¡Œç¨‹ã€è¨˜å¸³ã€ç…§ç‰‡ä¸€æ¬¡æ€§æ‰“åŒ…ä¸‹è¼‰ï¼Œé˜²æ­¢è³‡æ–™éºå¤±ã€‚</p>
                  <div class="grid grid-cols-2 gap-3">
                      <button @click="exportAllData" class="bg-teal-500 text-white py-3 rounded-xl font-bold text-sm shadow-md shadow-teal-100 active:scale-95 transition flex flex-col items-center justify-center gap-1">
                          <span class="text-xl">â˜ï¸</span> ä¸€éµä¸‹è¼‰å‚™ä»½
                      </button>
                      <label class="bg-white border-2 border-dashed border-teal-200 text-teal-500 py-3 rounded-xl font-bold text-sm cursor-pointer active:scale-95 transition flex flex-col items-center justify-center gap-1 hover:bg-teal-50">
                          <span class="text-xl">ğŸ”„</span> å°å…¥å®Œæ•´å‚™ä»½
                          <input type="file" @change="importAllData" accept=".json" class="hidden">
                      </label>
                  </div>
              </div>
              <div class="bg-white p-5 rounded-2xl card-shadow">
                  <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">ğŸ’± åŒ¯ç‡è¨ˆç®—</h3>
                  <div class="flex items-center gap-2 mb-4">
                      <span class="text-xs text-gray-400">è¨­å®š: 1 JPY = </span>
                      <input v-model.number="rate" type="number" step="0.001" class="w-20 bg-gray-50 p-1 text-center rounded text-sm">
                      <span class="text-xs text-gray-400">HKD</span>
                  </div>
                  <div class="grid grid-cols-[1fr,auto,1fr] gap-2 items-center">
                      <div>
                          <label class="text-xs text-gray-400 block mb-1">æ—¥åœ“ (JPY)</label>
                          <input v-model="calcYen" @input="updateHkd" type="number" class="w-full bg-gray-50 p-3 rounded-xl font-bold text-teal-600 outline-none focus:ring-2 focus:ring-teal-200">
                      </div>
                      <div class="text-gray-300">â†”</div>
                      <div>
                          <label class="text-xs text-gray-400 block mb-1">æ¸¯å¹£ (HKD)</label>
                          <input v-model="calcHkd" @input="updateYen" type="number" class="w-full bg-gray-50 p-3 rounded-xl font-bold text-teal-600 outline-none focus:ring-2 focus:ring-teal-200">
                      </div>
                  </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                  <a href="https://translate.google.com/?sl=ja&tl=zh-TW&op=translate" target="_blank" class="bg-blue-50 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 hover:bg-blue-100 transition">
                      <span class="text-3xl">ğŸ—£ï¸</span> <span class="font-bold text-blue-600 text-sm">Google ç¿»è­¯</span>
                  </a>
                  <a href="https://weathernews.jp/onebox/34.693748/135.502186" target="_blank" class="bg-orange-50 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 hover:bg-orange-100 transition">
                      <span class="text-3xl">ğŸŒ¤ï¸</span> <span class="font-bold text-orange-600 text-sm">å¤§é˜ªå¤©æ°£</span>
                  </a>
              </div>
          </div>

          <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-6 py-3 flex justify-between items-center z-30 max-w-md mx-auto text-[10px]">
              <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'text-teal-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition"><span class="text-xl">ğŸ“…</span> è¡Œç¨‹</button>
              <button @click="currentTab = 'shopping'" :class="currentTab === 'shopping' ? 'text-teal-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition"><span class="text-xl">ğŸ›ï¸</span> è¨˜å¸³</button>
              <button @click="currentTab = 'photos'" :class="currentTab === 'photos' ? 'text-teal-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition"><span class="text-xl">ğŸ“·</span> ç›¸å†Š</button>
              <button @click="currentTab = 'tools'" :class="currentTab === 'tools' ? 'text-teal-500' : 'text-gray-400'" class="flex flex-col items-center gap-1 transition"><span class="text-xl">ğŸ§°</span> å·¥å…·</button>
          </nav>

          <transition name="fade">
              <div v-if="showModal" @click="showModal = false" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                  <img :src="modalImage" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl">
                  <button class="absolute top-4 right-4 text-white text-3xl">Ã—</button>
              </div>
          </transition>

      </div>

      <script>
          const { createApp, ref, computed, watch, onMounted } = Vue;

          createApp({
              setup() {
                  const currentTab = ref('itinerary');
                  const currentDayIndex = ref(0);
                  
                  const defaultItinerary = [
                      { date: '12/05 (å››)', events: [{ id: 1, time: '08:00', activity: 'é¦™æ¸¯æ©Ÿå ´é›†åˆ', location: 'é¦™æ¸¯åœ‹éš›æ©Ÿå ´ T1', transport: 'æ©Ÿå ´å¿«ç·š', isEditing: false }, { id: 2, time: '11:30', activity: 'HX618 èµ·é£›', location: 'HKG -> KIX', transport: 'é£›æ©Ÿ', isEditing: false }, { id: 3, time: '16:00', activity: 'æŠµé”å¤§é˜ª', location: 'é—œè¥¿åœ‹éš›æ©Ÿå ´', transport: 'å…¥å¢ƒ', isEditing: false }, { id: 4, time: '18:00', activity: 'å‰å¾€å¸‚å€', location: 'å¤§é˜ªå¸‚å€', transport: 'å—æµ·é›»éµ', isEditing: false }] },
                      { date: '12/06 (äº”)', events: [{ id: 5, time: '09:00', activity: 'é–‹å§‹è¡Œç¨‹', location: 'å¤§é˜ª', transport: '', isEditing: false }] },
                      { date: '12/07 (å…­)', events: [{ id: 6, time: '09:00', activity: 'é–‹å§‹è¡Œç¨‹', location: 'å¤§é˜ª', transport: '', isEditing: false }] },
                      { date: '12/08 (æ—¥)', events: [{ id: 7, time: '09:00', activity: 'é–‹å§‹è¡Œç¨‹', location: 'å¤§é˜ª', transport: '', isEditing: false }] },
                      { date: '12/09 (ä¸€)', events: [{ id: 8, time: '10:00', activity: 'æœ€å¾Œè³¼ç‰©', location: 'é›£æ³¢', transport: '', isEditing: false }, { id: 9, time: '13:00', activity: 'å‰å¾€æ©Ÿå ´', location: 'é—œè¥¿åœ‹éš›æ©Ÿå ´', transport: 'å—æµ·é›»éµ', isEditing: false }, { id: 10, time: '16:00', activity: 'æº–å‚™ç™»æ©Ÿ', location: 'KIX -> HKG', transport: 'é£›æ©Ÿ', isEditing: false }] }
                  ];
                  const itinerary = ref(defaultItinerary);
                  const shoppingList = ref([]);
                  const photos = ref([]);
                  const rate = ref(0.052);

                  // æ¥µç°¡åˆ†é¡é…ç½® (ç§»é™¤ iconï¼Œä½¿ç”¨é¡è‰²é¡)
                  const categories = [
                      { id: 'shop', name: 'è³¼ç‰©', activeClass: 'bg-pink-500 text-white shadow-md shadow-pink-200', bg: 'bg-pink-100', text: 'text-pink-500' },
                      { id: 'food', name: 'é£²é£Ÿ', activeClass: 'bg-orange-500 text-white shadow-md shadow-orange-200', bg: 'bg-orange-100', text: 'text-orange-500' },
                      { id: 'gift', name: 'æ‰‹ä¿¡', activeClass: 'bg-purple-500 text-white shadow-md shadow-purple-200', bg: 'bg-purple-100', text: 'text-purple-500' },
                      { id: 'transport', name: 'äº¤é€š', activeClass: 'bg-blue-500 text-white shadow-md shadow-blue-200', bg: 'bg-blue-100', text: 'text-blue-500' },
                      { id: 'ticket', name: 'é–€ç¥¨', activeClass: 'bg-yellow-500 text-white shadow-md shadow-yellow-200', bg: 'bg-yellow-100', text: 'text-yellow-600' },
                      { id: 'other', name: 'å…¶ä»–', activeClass: 'bg-gray-600 text-white shadow-md shadow-gray-200', bg: 'bg-gray-100', text: 'text-gray-500' }
                  ];
                  const newItem = ref({ name: '', price: '', forWhom: '', category: 'shop' });
                  const tempShopImg = ref(null);

                  const calcYen = ref('');
                  const calcHkd = ref('');
                  const showModal = ref(false);
                  const modalImage = ref('');

                  const sortEvents = (dayIdx) => { itinerary.value[dayIdx].events.sort((a, b) => a.time.localeCompare(b.time)); };
                  
                  onMounted(() => {
                      const savedItinerary = localStorage.getItem('minty_itinerary_v3');
                      if (savedItinerary) { itinerary.value = JSON.parse(savedItinerary); itinerary.value.forEach((d, i) => sortEvents(i)); }
                      const savedShopping = localStorage.getItem('minty_shopping_v2');
                      if (savedShopping) shoppingList.value = JSON.parse(savedShopping);
                      const savedPhotos = localStorage.getItem('minty_photos_v2');
                      if (savedPhotos) photos.value = JSON.parse(savedPhotos);
                      const savedRate = localStorage.getItem('minty_rate_v2');
                      if (savedRate) rate.value = Number(savedRate);
                  });

                  watch(itinerary, (v) => localStorage.setItem('minty_itinerary_v3', JSON.stringify(v)), { deep: true });
                  watch(shoppingList, (v) => localStorage.setItem('minty_shopping_v2', JSON.stringify(v)), { deep: true });
                  watch(photos, (v) => localStorage.setItem('minty_photos_v2', JSON.stringify(v)), { deep: true });
                  watch(rate, (v) => localStorage.setItem('minty_rate_v2', v));

                  const toggleEdit = (d, e) => { const evt = itinerary.value[d].events[e]; if(evt.isEditing) { evt.isEditing = false; sortEvents(d); } else { evt.isEditing = true; } };
                  const addEvent = (d) => itinerary.value[d].events.push({ id: Date.now(), time: '12:00', activity: 'æ–°è¡Œç¨‹', location: '', isEditing: true });
                  const deleteEvent = (d, e) => { if(confirm('åˆªé™¤ï¼Ÿ')) itinerary.value[d].events.splice(e, 1); };
                  const getMapLink = (l) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(l || 'å¤§é˜ª')}`;
                  const copyItineraryText = () => { let t = "ğŸ‡¯ğŸ‡µ è¡Œç¨‹åˆ†äº«\n"; itinerary.value.forEach(d => { t += `\nğŸ“… ${d.date}\n`; [...d.events].sort((a,b)=>a.time.localeCompare(b.time)).forEach(e => t += `${e.time} ${e.activity} @${e.location||''}\n`); }); navigator.clipboard.writeText(t).then(()=>alert('å·²è¤‡è£½')); };

                  const compressImage = (file, w, q, cb) => { const r = new FileReader(); r.onload = (e) => { const i = new Image(); i.onload = () => { const c = document.createElement('canvas'); const x = c.getContext('2d'); let nw = i.width, nh = i.height; if(nw>w){nh*=w/nw;nw=w;} c.width=nw; c.height=nh; x.drawImage(i,0,0,nw,nh); cb(c.toDataURL('image/jpeg', q)); }; i.src = e.target.result; }; r.readAsDataURL(file); };
                  const handleShopImgUpload = (e) => { if(e.target.files[0]) compressImage(e.target.files[0], 600, 0.6, (res) => tempShopImg.value = res); };
                  const addItem = () => { if (!newItem.value.name || !newItem.value.price) return; shoppingList.value.unshift({ ...newItem.value, image: tempShopImg.value }); newItem.value = { name: '', price: '', forWhom: '', category: 'shop' }; tempShopImg.value = null; };
                  const deleteItem = (i) => shoppingList.value.splice(i, 1);
                  const totalYen = computed(() => shoppingList.value.reduce((s, i) => s + (Number(i.price) || 0), 0));
                  const totalHKD = computed(() => (totalYen.value * rate.value).toFixed(1));
                  
                  // åˆ†é¡è¼”åŠ©
                  const getCategoryName = (id) => categories.find(c => c.id === id)?.name || 'å…¶ä»–';
                  const getCategoryBg = (id) => categories.find(c => c.id === id)?.bg || 'bg-gray-100';
                  const getCategoryText = (id) => categories.find(c => c.id === id)?.text || 'text-gray-500';

                  const handlePhotoUpload = (e) => { if(e.target.files[0]) compressImage(e.target.files[0], 800, 0.7, (res) => { const d = new Date(); photos.value.unshift({ src: res, date: `${d.getMonth()+1}/${d.getDate()}`, originalIndex: 0 }); }); };
                  const groupedPhotos = computed(() => { const g = {}; photos.value.forEach((p, i) => { if(!g[p.date]) g[p.date]=[]; g[p.date].push({...p, originalIndex: i}); }); return g; });
                  const deletePhoto = (i) => { if(confirm('åˆªé™¤ï¼Ÿ')) photos.value.splice(i, 1); };

                  const exportAllData = () => { const fullData = { itinerary: itinerary.value, shopping: shoppingList.value, photos: photos.value, rate: rate.value, version: '4.1', backupDate: new Date().toLocaleString() }; downloadJSON(fullData, `Minty_Full_Backup_${Date.now()}.json`); };
                  const importAllData = (e) => { const file = e.target.files[0]; if(!file) return; if(!confirm('ç¢ºå®šè¦å°å…¥å‚™ä»½å—ï¼Ÿé€™å°‡è¦†è“‹ç•¶å‰æ‰€æœ‰è³‡æ–™ï¼')) return; const reader = new FileReader(); reader.onload = (evt) => { try { const data = JSON.parse(evt.target.result); if(data.itinerary) itinerary.value = data.itinerary; if(data.shopping) shoppingList.value = data.shopping; if(data.photos) photos.value = data.photos; if(data.rate) rate.value = data.rate; itinerary.value.forEach((d, i) => sortEvents(i)); alert('ğŸ‰ æ•¸æ“šå·²æˆåŠŸæ¢å¾©ï¼'); } catch(err) { alert('å‚™ä»½æª”æ ¼å¼éŒ¯èª¤æˆ–æå£ã€‚'); } }; reader.readAsText(file); };

                  const openImageModal = (src) => { modalImage.value = src; showModal.value = true; };
                  const updateHkd = () => { calcHkd.value = (calcYen.value * rate.value).toFixed(2); };
                  const updateYen = () => { calcYen.value = (calcHkd.value / rate.value).toFixed(0); };
                  const formatNumber = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                  const downloadJSON = (d, n) => { const b = new Blob([JSON.stringify(d)], {type:'application/json'}); const l = document.createElement('a'); l.href = URL.createObjectURL(b); l.download = n; document.body.appendChild(l); l.click(); document.body.removeChild(l); };

                  return {
                      currentTab, currentDayIndex, itinerary, shoppingList, newItem, rate, totalYen, totalHKD, tempShopImg, photos, groupedPhotos, calcYen, calcHkd, showModal, modalImage, categories,
                      toggleEdit, addEvent, deleteEvent, getMapLink, copyItineraryText,
                      addItem, deleteItem, handleShopImgUpload, getCategoryName, getCategoryBg, getCategoryText,
                      handlePhotoUpload, deletePhoto, openImageModal,
                      exportAllData, importAllData,
                      updateHkd, updateYen, formatNumber
                  };
              }
          }).mount('#app');
      </script>
  </body>
  </html>
